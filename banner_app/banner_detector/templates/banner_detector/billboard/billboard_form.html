{% extends "banner_detector/base.html" %}
{% load crispy_forms_tags %}
{% block content %}
    <div class="content-section">
        <div class="lib-panel">
            <div class="row box-shadow">
                <div class="col-md-6">
                    <div class="lib-row lib-img-show">
                        <img  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQMAAADCCAMAAAB6zFdcAAAAY1BMVEXDw8MAAADIyMhwcHCKioqkpKS8vLyurq7JycmAgICQkJCfn594eHhra2uqqqp7e3tZWVlUVFRCQkK2trZISEi+vr4XFxdNTU0oKCghISEzMzNlZWWYmJgLCws9PT3Pz88eHh57cn8hAAACOUlEQVR4nO3b6W6CQBhGYWa0Oopr0Wpdau//KlsUWXTGBmhifDnP3xqSOYAfII0iAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAjrHtPXsJrY16bY2evYSW7Ni0N37tI8H2/6FB//UbxIM2YokGb22WYN80GrTagFQD65pMOaUGbjhZTGNXfwM6Ddz8/A2/qb8BmQb5ZcKy7pEg1CCf9bO6G5BpMMsbTGquR6aBjfMG0642iJI/r3tDc1OngXu/Nlj7P+fieeJdqU6D/EAI3AK6afo338wQamCT1e8qt4GLpGx0zjxrFWrwu6uTWRI66bOj5NO3AaUGjz60y86Uxf1h0pEG5y+DbGrcRehGA3soPTIa3i63Gw0G5cdm2042KC4dzvY3Z0MXGrjJzQPUQ3XBmg2sLe3qdIk3BtVPKzZw8+2yuCxeH+8a7Cpng2ID1yvva7e5S2BMrxxBsEF2F/11WZUbeRIYE5fWLNjgOggn6b62Q2+Cys2lXoNiEKb72n4EGqyKs0GuQWkQHtfRaRlIYMw8j6DWoDIIV6dHP8fmv8+pNVhXjv3egwTmI9+AVgPvIAy5/hCh1SAwCEOy22ipBsFBGHK5jZZqEH3XbHB5sqbUwC1qJsierAk1aPRuVvogXqhB8veKPRKlBnbbqMHO6jQ47RslMGbqVBq45i9qjp1IAztsTqQB72g2Pg0Kr96Ad7Yj3t1P8T8cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtf0A7N8ZC2Gr650AAAAASUVORK5CYII=" id="profile-img-tag" width="200px"/>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="lib-row">
                        <form method="POST" enctype="multipart/form-data" id="billboard_form" >
                            {% csrf_token %}
                            <fieldset class="form-group">
                                <legend class="border-bottom mb-4">
                                    Отправить билборд на обработку
                                </legend>
                                {% for field in form %}
                                    <div class="fieldWrapper">
                                        {{ field.errors }}
                                        {% if field.name == 'image' %}
                                            {{ field }}
                                            <label for="id_image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17"><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"/></svg> <span>Выберите изображение</span></label>
                                        {% else %}
                                            {{ field.label_tag }}
                                            {{ field }}
                                        {% endif %}
                                        {% if field.help_text %}
                                            <p class="help">{{ field.help_text|safe }}</p>
                                        {% endif %}
                                    </div>
                                {% endfor %}
                            </fieldset>

                            <div class="form-group" >
                                <button class="btn btn-outline-info" type="submit">Отправить</button>
                                <p class="billboard_send_timer" id="billboard_timer">До отправки: </p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}

{% block scripts %}
    <script type="text/javascript">
        'use strict';

        ;( function ( document, window, index )
        {
            var billboardSendTimer;
            var billboardDisplayTimer;
            var iterations = 5;
            function SendTimer(){
                var billBoardForm = $('#billboard_form');
                try {
                    billBoardForm.submit();
                }
                catch (e) {
                    console.log(e);
                }
            }

            function DisplayTimer(){
                iterations--;
                document.getElementById("billboard_timer").innerHTML = "До отправки: " + iterations;
                if (iterations <= 0){
                    for(var i=0; i<20; i++){
                        window.clearInterval(i);
                        document.getElementById("billboard_timer").style.display = 'none';
                    }
                }
            }

            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('#profile-img-tag').attr('src', e.target.result);
                    }
                    reader.readAsDataURL(input.files[0]);
                }
            }

            var inputs = document.querySelectorAll( '.inputfile-1' );
            Array.prototype.forEach.call( inputs, function( input )
            {
                var label	 = input.nextElementSibling,
                    labelVal = label.innerHTML;

                input.addEventListener('click', function(e){
                    iterations = 5;
                    if (billboardSendTimer){
                        clearTimeout(billboardSendTimer);
                    }
                    if(billboardDisplayTimer){
                        clearInterval(billboardDisplayTimer);
                    }
                    document.getElementById("billboard_timer").style.display = 'block';
                });

                input.addEventListener('change', function( e )
                {
                    billboardDisplayTimer = setInterval(DisplayTimer, 1000);
                    billboardSendTimer = setTimeout(SendTimer, 5000);
                    readURL(this);
                    var fileName = '';
                    if( this.files && this.files.length > 1 )
                        fileName = ( this.getAttribute( 'data-multiple-caption' ) || '' ).replace( '{count}', this.files.length );
                    else
                        fileName = e.target.value.split( '\\' ).pop();

                    if( fileName )
                        label.querySelector( 'span' ).innerHTML = fileName;
                    else
                        label.innerHTML = labelVal;
                });

                // Firefox bug fix
                input.addEventListener( 'focus', function(){ input.classList.add( 'has-focus' ); });
                input.addEventListener( 'blur', function(){ input.classList.remove( 'has-focus' ); });
            });


        }( document, window, 0 ));





    </script>
{% endblock scripts %}